/*!
 * Cirquity - Cirquity v0.1.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-pool/blob/master/LICENSE)
 */

!function(t){t((function(){currentPage={destroy:function(){},update:function(t){}};let e=setInterval((function(){lastStats&&(t.renderLogInfo(),t.loadTranslations(),clearInterval(e))}),10)})),t.getCheckTime=function(e){return e?t.timeago(new Date(1e3*e).toISOString()):null},t.monitoringInfoParse=function(e){let n={lastCheck:t.getCheckTime(e.monitoring.daemon.lastCheck)||"never",lastStatus:e.monitoring.daemon.lastStatus||"",lastFail:t.getCheckTime(e.monitoring.daemon.lastFail)||"never",lastFailResponse:JSON.stringify(JSON.parse(e.monitoring.daemon.lastFailResponse),null,4)||" ",lastResponse:JSON.stringify(JSON.parse(e.monitoring.daemon.lastResponse),null,4)||" "},o={lastCheck:t.getCheckTime(e.monitoring.wallet.lastCheck)||"never",lastStatus:e.monitoring.wallet.lastStatus||"",lastFail:t.getCheckTime(e.monitoring.wallet.lastFail)||"never",lastFailResponse:JSON.stringify(JSON.parse(e.monitoring.wallet.lastFailResponse),null,4)||" ",lastResponse:JSON.stringify(JSON.parse(e.monitoring.wallet.lastResponse),null,4)||" "},a={};if(e.hasOwnProperty("logs")){a.logs=e.logs;for(let n in e.logs)e.logs[n].changed=t.formatDate(e.logs[n].changed),e.logs[n].link=api+"/admin_log?file="+n+"&password="+docCookies.getItem("password")}return a.monitoringDaemon=n,a.monitoringWallet=o,a},t.renderLogInfo=function(e){let n=docCookies.getItem("password");n&&!e||(n=prompt("Enter admin password")),t.ajax({url:api+"/admin_monitoring",data:{password:n},dataType:"json",cache:!1,success:function(e){docCookies.setItem("password",n,1/0),t.renderAdminTemplate(t.monitoringInfoParse(e),"#monitoringInfo","#monitoringInfoView"),t("#daemonStatus").addClass("ok"==e.monitoring.daemon.lastStatus?"text-success":"text-danger"),t("#walletStatus").addClass("ok"==e.monitoring.wallet.lastStatus?"text-success":"text-danger"),t("#logTable th.sort").on("click",t.sortTable)},error:function(t){docCookies.removeItem("password")}})}}(jQuery);